<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PassKey Wallet Dashboard</title>

    <link rel="stylesheet" href="assets/dashboard.css">
</head>

<body>
    <div class="container">
        <header style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px; min-width: 0;">
                <img src="/passkey_wallet.svg" alt="App Logo" class="logo">
                <h1 style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin: 0;">PassKey Wallet
                </h1>
            </div>
            <button id="btnBurger" class="burger-menu" title="Menu"
                style="display: none; font-size: 1.5rem; padding: 8px 12px;">‚ò∞</button>
        </header>

        <div class="actions" id="mainActions">
            <button class="primary" id="btnAdd">+ Add Password</button>
            <button id="btnImport" title="Import from XLSX file (Columns: Domain, Username, Password)">Import
                Excel</button>
            <button id="btnBackup" title="Export secure backup">Backup .qpass</button>
            <button id="btnRestore" title="Restore from secure backup">Restore .qpass</button>
            <button id="btnSettings" title="App Settings">Settings</button>
            <button id="btnLock" class="btn-danger" title="Lock App Now">Lock üîí</button>
            <button id="btnHelp" title="User Check Manual">Help ‚ùì</button>
            <button id="btnDeleteAll" class="btn-danger" title="Delete all credentials from vault">Delete All</button>
        </div>


        <!-- ... table ... -->

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <h2>Settings</h2>
                <form id="settingsForm">
                    <label>Auto-Lock Duration (minutes)</label>
                    <input type="number" id="inpAutoLock" min="1" max="1440" required>
                    <small style="color: #666; display:block; margin-top:4px;">App will lock after system is idle for
                        this long.</small>

                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1rem;">
                        <button type="button" id="btnSettingsCancel">Cancel</button>
                        <button type="submit" class="primary">Save</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Search Bar -->
        <div style="margin-bottom: 20px; position: relative;">
            <input type="text" id="searchInput" placeholder="üîç Search by domain or username..."
                style="width: 100%; padding: 12px 40px 12px 15px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-main); font-size: 14px;">
            <button id="clearSearch"
                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; padding: 5px 10px; display: none;"
                title="Clear search">‚úï</button>
        </div>

        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Domain</th>
                        <th>Username</th>
                        <th>Password</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows will be injected here -->
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <button id="btnPrev" disabled>‚Üê Previous</button>
            <span id="pageInfo">Page 1</span>
            <button id="btnNext" disabled>Next ‚Üí</button>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Add Credential</h2>
            <form id="credForm">
                <input type="hidden" id="editId">

                <label>Domain (e.g., github.com)</label>
                <input type="text" id="inpDomain" required placeholder="github.com">

                <label>Username</label>
                <input type="text" id="inpUser" required placeholder="me@email.com">

                <label>Password</label>
                <div class="input-group">
                    <input type="password" id="inpPass" required placeholder="Secret123!">
                    <button type="button" class="toggle-password" data-target="inpPass" tabindex="-1">üëÅÔ∏è</button>
                </div>

                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1rem;">
                    <button type="button" id="btnCancel">Cancel</button>
                    <button type="submit" class="primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2>User Manual PassKey Wallet</h2>
            <div style="overflow-y: auto; max-height: 400px; line-height: 1.6;">
                <h3>Navigation & Buttons</h3>
                <ul>
                    <li><b>Add Credential:</b> Create a new password entry manually.</li>
                    <li><b>Import Excel:</b> Load passwords from an XLSX file. Columns should be: <i>Domain,
                            Username, Password</i>.</li>
                    <li><b>Backup .qpass:</b> Export your entire vault to an encrypted file. You set a password for
                        this file.</li>
                    <li><b>Restore .qpass:</b> Load a previously backed-up .qpass file. Requires the password you set.
                    </li>
                    <li><b>Lock:</b> Immediately closes the database and clears memory. Use this when stepping away.
                    </li>
                </ul>

                <h3>Security Features</h3>
                <ul>
                    <li><b>Auto-Lock:</b> The app locks itself after 60 minutes (default) of inactivity.</li>
                    <li><b>Overlay (Ctrl+Alt+P):</b> Press this global shortcut to find passwords. Click on the
                        <b>User</b> or <b>Pass</b> to copy them to your clipboard.
                    </li>
                    <li><b>Clipboard:</b> Passwords are copied to clipboard. Be careful to paste them only where
                        intended.</li>
                </ul>

                <h3>üåê Browser Extension Setup</h3>
                <ul>
                    <li><b>Step 1:</b> Click <b>Settings</b> ‚Üí <b>Browser Extension</b> to open the extension folder
                    </li>
                    <li><b>Step 2:</b> Open your browser's extension page:
                        <ul>
                            <li>Chrome/Edge/Brave: <code>chrome://extensions</code></li>
                            <li>Firefox: <code>about:debugging#/runtime/this-firefox</code></li>
                        </ul>
                    </li>
                    <li><b>Step 3:</b> Enable <b>Developer mode</b> (toggle in top-right)</li>
                    <li><b>Step 4:</b> Click <b>Load unpacked</b> and select the extension folder</li>
                    <li><b>Step 5:</b> Run the native messaging host installer (in the extension folder)</li>
                </ul>

                <h3>üí° Recommendation</h3>
                <ul>
                    <li><b>Regular Backups:</b> We strongly recommend backing up your password vault regularly using
                        the <b>"Backup .qpass"</b> button. Store the backup file in a secure location.</li>
                </ul>
            </div>
            <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                <button type="button" id="btnHelpClose" class="primary">Close</button>
            </div>
        </div>
    </div>

    <!-- Password Prompt Modal -->
    <div id="passModal" class="modal">
        <div class="modal-content" style="width: 300px;">
            <h2 id="passModalTitle">Enter Password</h2>
            <p id="passModalDesc" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">Enter
                encryption password for backup:</p>
            <form id="passForm">
                <div class="input-group">
                    <input type="password" id="backupPassword" required placeholder="Encryption Password" autofocus>
                    <button type="button" class="toggle-password" data-target="backupPassword"
                        tabindex="-1">üëÅÔ∏è</button>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1rem;">
                    <button type="button" id="btnPassCancel">Cancel</button>
                    <button type="submit" class="primary">Confirm</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Alert/Confirm Modal -->
    <div id="customDialog" class="modal">
        <div class="modal-content" style="width: 350px;">
            <h2 id="dialogTitle">Notice</h2>
            <p id="dialogMessage"
                style="color: var(--text-muted); font-size: 0.95rem; margin-bottom: 1.5rem; line-height: 1.5;"></p>
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button type="button" id="dialogCancel" style="display: none;">Cancel</button>
                <button type="button" id="dialogConfirm" class="primary">OK</button>
            </div>
        </div>
    </div>

    <script type="module" src="assets/dashboard.js"></script>
</body>

</html>