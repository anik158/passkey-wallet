<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PassKey Overlay</title>
  <link rel="stylesheet" href="overlay.css" />
</head>

<body>
  <div id="container">
    <div class="card">
      <div class="header">
        <img src="/passkey_wallet.svg" alt="Logo" class="logo">
        <div class="title-group">
          <div class="domain" id="domain">Detecting...</div>
          <div class="app-name" id="appName">...</div>
        </div>
        <button class="close-btn" id="btnClose">×</button>
      </div>

      <div id="content">
        <!-- Inject credentials here -->
      </div>
      <div class="footer-hints"
        style="margin-top: auto; padding-top: 10px; border-top: 1px solid #333; font-size: 0.75rem; color: #666; display: flex; justify-content: space-between;">
        <span>Click to Copy</span>
        <span>Esc to Close</span>
      </div>
    </div>
  </div>

  <script>
    const domainEl = document.getElementById('domain')
    const appNameEl = document.getElementById('appName')
    const contentEl = document.getElementById('content')
    const btnClose = document.getElementById('btnClose')

    btnClose.onclick = () => window.api.hideOverlay()

    window.api.onShowCredentials((data) => {
      domainEl.textContent = data.site
      appNameEl.textContent = data.appName ? `via ${data.appName}` : ''

      contentEl.innerHTML = '' // Clear previous content

      if (!data.username) {
        // No credentials found
        const noData = document.createElement('div');
        noData.className = 'row';
        noData.innerHTML = '<span class="value" style="color: #666; font-style: italic;">No details found</span>';
        contentEl.appendChild(noData);
        return;
      }

      // User Row
      const userRow = document.createElement('div');
      userRow.className = 'row';
      userRow.innerHTML = `
                <span class="label">User:</span>
                <span class="value clickable">${data.username}</span>
            `;
      userRow.querySelector('.value').onclick = () => {
        window.api.copyToClipboard(data.username);
        window.api.hideOverlay();
      };
      contentEl.appendChild(userRow);

      // Pass Row
      const passRow = document.createElement('div');
      passRow.className = 'row';
      passRow.innerHTML = `
                <span class="label">Pass:</span>
                <span class="value clickable masked">••••••••</span>
            `;
      const passVal = passRow.querySelector('.value');
      passVal.onclick = () => {
        passVal.textContent = data.password;
        passVal.classList.remove('masked');
        window.api.copyToClipboard(data.password);
        setTimeout(() => window.api.hideOverlay(), 1200);
      };
      contentEl.appendChild(passRow);
    })

    // Close on Esc
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        window.api.hideOverlay()
      }
    })
  </script>
</body>

</html>